{
  "caso": {
    "id": 2,
    "titulo": "Sistema Multiagente - Supervisi√≥n de Obra",
    "descripcion": "Sistema de agentes especializados para supervisi√≥n autom√°tica de obras ferroviarias"
  },
  "layers": [
    {
      "id": 0,
      "nombre": "Problema de Negocio",
      "es_introduccion": true,
      "problema": {
        "titulo": "El Desaf√≠o de la Supervisi√≥n de Obras Ferroviarias",
        "descripcion": "INECO supervisa obras ferroviarias complejas en m√∫ltiples pa√≠ses. La supervisi√≥n manual presenta desaf√≠os cr√≠ticos:",
        "puntos": [
          "üì∑ Miles de im√°genes de drones diarias que revisar manualmente",
          "üë∑ Inspectores en campo limitados (1 por cada 5km de obra)",
          "‚è∞ Detecci√≥n de desviaciones tarda 2-3 d√≠as (cuando ya hay sobrecostes)",
          "üìä Comparaci√≥n manual con planos y normativas (propenso a errores)",
          "üîÑ Sin integraci√≥n con gemelo digital TWINECO en tiempo real"
        ],
        "impacto": "Las desviaciones detectadas tarde generan sobrecostes del 15-20%. La falta de supervisi√≥n continua compromete calidad y seguridad."
      },
      "solucion": {
        "titulo": "¬øPor qu√© un Sistema Multiagente?",
        "descripcion": "Un sistema de agentes especializados puede:",
        "beneficios": [
          "üëÅÔ∏è Analizar autom√°ticamente im√°genes de drones en tiempo real",
          "‚ö° Detectar desviaciones en minutos en lugar de d√≠as",
          "ü§ñ Especializaci√≥n: cada agente domina una tarea espec√≠fica",
          "üîó Integraci√≥n autom√°tica con TWINECO (gemelo digital)",
          "üìã Validaci√≥n contra normativas ADIF/UIC sin intervenci√≥n humana"
        ],
        "enfoque": "Construiremos el sistema capa por capa: desde un agente √∫nico hasta una arquitectura multiagente robusta, segura y confiable."
      }
    },
    {
      "id": 1,
      "nombre": "Sistema Base",
      "componentes": [
        {
          "tipo": "input",
          "label": "IM√ÅGENES DRONES",
          "descripcion": "Fotograf√≠as a√©reas de obra",
          "ejemplo": "imagen_obra_tramo_5.jpg"
        },
        {
          "tipo": "agent",
          "label": "AGENTE AN√ÅLISIS",
          "descripcion": "Agente √∫nico que hace todo",
          "ejemplo": "Tiempo: 8 segundos"
        },
        {
          "tipo": "output",
          "label": "ALERTA",
          "descripcion": "Notificaci√≥n de desviaci√≥n",
          "ejemplo": "Desviaci√≥n detectada: 3cm respecto a plano"
        }
      ],
      "puntos_fuertes": [
        {
          "texto": "Detecta desviaciones autom√°ticamente",
          "explicacion": "El agente analiza im√°genes y detecta diferencias respecto a planos: posici√≥n de v√≠a, estructuras, elementos de seguridad. Automatiza trabajo manual de inspectores."
        },
        {
          "texto": "Procesa im√°genes de drones",
          "explicacion": "Computer vision integrado: reconoce elementos ferroviarios (v√≠as, traviesas, balasto, catenaria) y mide dimensiones con precisi√≥n milim√©trica."
        },
        {
          "texto": "Genera alertas",
          "explicacion": "Cuando detecta una desviaci√≥n, crea autom√°ticamente una alerta con ubicaci√≥n, tipo de problema y severidad estimada."
        }
      ],
      "problemas": [
        {
          "texto": "Un solo agente hace todo (sobrecarga)",
          "explicacion": "El agente debe: analizar imagen, validar normativa, actualizar TWINECO, generar informe. Demasiadas responsabilidades ‚Üí lento y propenso a errores."
        },
        {
          "texto": "No valida contra normativa t√©cnica",
          "explicacion": "Detecta la desviaci√≥n pero no sabe si est√° dentro de tolerancias permitidas por ADIF. Un inspector debe validar manualmente cada alerta."
        },
        {
          "texto": "No actualiza gemelo digital (TWINECO)",
          "explicacion": "La desviaci√≥n detectada no se refleja en TWINECO. El gemelo digital queda desactualizado, perdiendo valor como fuente de verdad."
        },
        {
          "texto": "No puede acceder a herramientas peligrosas de forma controlada",
          "explicacion": "Si necesita actualizar TWINECO o enviar alertas cr√≠ticas, no hay control sobre qu√© puede hacer. Riesgo de acciones no autorizadas."
        },
        {
          "texto": "Sin monitorizaci√≥n de rendimiento",
          "explicacion": "No sabemos si el agente funciona correctamente: ¬øcu√°ntas im√°genes procesa? ¬øcu√°nto tarda? ¬øcu√°ntos errores tiene? Caja negra."
        },
        {
          "texto": "Sin validaci√≥n de confianza en decisiones",
          "explicacion": "¬øQu√© tan seguro est√° el agente de que hay una desviaci√≥n? ¬øEs 50% o 99% de confianza? Sin esto, no sabemos si confiar en las alertas."
        }
      ],
      "problemas_resueltos": []
    },
    {
      "id": 2,
      "nombre": "Orquestaci√≥n de Agentes Especializados",
      "componentes": [
        {
          "tipo": "input",
          "label": "IM√ÅGENES",
          "descripcion": "Input de drones"
        },
        {
          "tipo": "agent",
          "label": "COORDINADOR",
          "descripcion": "Orquesta el flujo entre agentes",
          "ejemplo": "Distribuye tareas y recopila resultados"
        },
        {
          "tipo": "agent",
          "label": "COMPUTER VISION",
          "descripcion": "Analiza im√°genes",
          "ejemplo": "Tiempo: 2s - Desviaci√≥n 3cm detectada"
        },
        {
          "tipo": "agent",
          "label": "VALIDADOR NORMATIVO",
          "descripcion": "Valida contra normas ADIF",
          "ejemplo": "Tiempo: 1s - Fuera de tolerancia"
        },
        {
          "tipo": "agent",
          "label": "GEMELO DIGITAL",
          "descripcion": "Actualiza TWINECO",
          "ejemplo": "Tiempo: 1s - Estado: ALERTA CR√çTICA"
        },
        {
          "tipo": "agent",
          "label": "GENERADOR INFORMES",
          "descripcion": "Crea documentaci√≥n",
          "ejemplo": "Tiempo: 3s - informe_desviacion_tramo5.pdf"
        },
        {
          "tipo": "output",
          "label": "OUTPUT",
          "descripcion": "Resultado completo",
          "ejemplo": "Total tiempo: 7s (vs 8s anterior)"
        }
      ],
      "puntos_fuertes": [
        {
          "texto": "Especializaci√≥n: cada agente una funci√≥n",
          "explicacion": "Computer Vision solo analiza im√°genes. Validador solo verifica normativas. Cada agente es experto en su dominio ‚Üí mayor precisi√≥n y mantenibilidad."
        },
        {
          "texto": "Paralelizaci√≥n de tareas",
          "explicacion": "Mientras Computer Vision analiza imagen 2, Validador procesa resultado de imagen 1. Ejecuci√≥n concurrente ‚Üí 12% m√°s r√°pido que agente √∫nico."
        },
        {
          "texto": "Integraci√≥n con TWINECO",
          "explicacion": "Agente Gemelo Digital actualiza autom√°ticamente el modelo 3D con cada desviaci√≥n detectada. TWINECO siempre refleja estado real de la obra."
        },
        {
          "texto": "Validaci√≥n normativa autom√°tica",
          "explicacion": "Agente Validador conoce todas las normativas ADIF/UIC. Verifica autom√°ticamente si desviaci√≥n est√° dentro de tolerancias. Reduce falsos positivos 80%."
        },
        {
          "texto": "Comunicaci√≥n A2A/MCP entre agentes",
          "explicacion": "Agentes se comunican mediante protocolo MCP (Model Context Protocol). Mensajes estructurados, trazables y con retry autom√°tico si hay fallos."
        }
      ],
      "problemas": [
        {
          "texto": "Agentes pueden ejecutar acciones peligrosas sin control",
          "explicacion": "Agente Gemelo Digital puede modificar TWINECO sin restricciones. ¬øY si un bug hace que marque toda la obra como 'CR√çTICO'? No hay permisos granulares."
        },
        {
          "texto": "Sin m√©tricas de rendimiento",
          "explicacion": "No sabemos qu√© agente es el cuello de botella. ¬øComputer Vision tarda mucho? ¬øValidador falla a menudo? Sin m√©tricas, no podemos optimizar."
        },
        {
          "texto": "¬øC√≥mo sabemos si las decisiones son correctas?",
          "explicacion": "Si Computer Vision dice 'desviaci√≥n 3cm' y Validador dice 'cr√≠tico', ¬øc√≥mo verificamos que es correcto? No hay validaci√≥n cruzada ni evidencia documental."
        }
      ],
      "problemas_resueltos": [
        {
          "texto": "Un solo agente sobrecargado",
          "explicacion": "Resuelto: 5 agentes especializados distribuyen la carga. Cada uno domina su funci√≥n."
        },
        {
          "texto": "No valida normativa",
          "explicacion": "Resuelto: Agente Validador Normativo verifica autom√°ticamente contra ADIF/UIC."
        },
        {
          "texto": "No actualiza gemelo digital",
          "explicacion": "Resuelto: Agente Gemelo Digital sincroniza autom√°ticamente con TWINECO."
        }
      ]
    },
    {
      "id": 3,
      "nombre": "Tool Use Security y Entitlements",
      "componentes": [
        {
          "tipo": "input",
          "label": "IM√ÅGENES",
          "descripcion": "Input"
        },
        {
          "tipo": "agent",
          "label": "COORDINADOR",
          "descripcion": "Orquestador"
        },
        {
          "tipo": "security",
          "label": "POLICY ENGINE",
          "descripcion": "Controla permisos de cada agente",
          "ejemplo": "CV: ‚úÖ READ_IMAGES ‚ùå WRITE_DATABASE"
        },
        {
          "tipo": "agent",
          "label": "COMPUTER VISION",
          "descripcion": "Con permisos limitados",
          "ejemplo": "Permisos: READ_IMAGES, ANALYZE_IMAGE"
        },
        {
          "tipo": "agent",
          "label": "VALIDADOR NORMATIVO",
          "descripcion": "Con permisos espec√≠ficos"
        },
        {
          "tipo": "agent",
          "label": "GEMELO DIGITAL",
          "descripcion": "Requiere aprobaci√≥n humana",
          "ejemplo": "Human-in-the-Loop para acciones cr√≠ticas"
        },
        {
          "tipo": "agent",
          "label": "GENERADOR INFORMES",
          "descripcion": "Con permisos de escritura"
        },
        {
          "tipo": "security",
          "label": "AUDIT LOG",
          "descripcion": "Registra intentos no autorizados",
          "ejemplo": "Intento bloqueado - CV - 14:32:18"
        },
        {
          "tipo": "output",
          "label": "OUTPUT",
          "descripcion": "Resultado seguro"
        }
      ],
      "puntos_fuertes": [
        {
          "texto": "Principle of Least Privilege aplicado",
          "explicacion": "Cada agente solo tiene los permisos m√≠nimos necesarios. Computer Vision puede leer im√°genes pero no escribir en TWINECO. Reduce superficie de ataque."
        },
        {
          "texto": "Whitelisting de funciones por agente",
          "explicacion": "Lista expl√≠cita de funciones permitidas por agente. Computer Vision: [analyze_image, detect_objects]. Cualquier otra funci√≥n ‚Üí bloqueada."
        },
        {
          "texto": "Aprobaci√≥n humana para acciones cr√≠ticas",
          "explicacion": "Si Agente Gemelo Digital quiere cambiar estado de infraestructura a 'SHUTDOWN', requiere aprobaci√≥n de ingeniero senior. Human-in-the-Loop para decisiones cr√≠ticas."
        },
        {
          "texto": "Auditor√≠a de intentos no autorizados",
          "explicacion": "Cada intento de ejecutar funci√≥n no permitida se registra: agente, funci√≥n, timestamp. Permite detectar comportamientos an√≥malos o bugs."
        },
        {
          "texto": "Function Whitelist por agente",
          "explicacion": "Configuraci√≥n declarativa de permisos. F√°cil de auditar y modificar. Ejemplo: Validador puede [read_norms, validate_spec] pero no [write_db, send_email]."
        }
      ],
      "problemas": [
        {
          "texto": "Sin m√©tricas de rendimiento",
          "explicacion": "Aunque tenemos seguridad, seguimos sin saber: ¬øcu√°nto tarda cada agente? ¬øcu√°ntas im√°genes procesa por minuto? ¬øcu√°l es el accuracy?"
        },
        {
          "texto": "¬øC√≥mo validamos que decisiones son correctas?",
          "explicacion": "Tenemos permisos pero no validaci√≥n de calidad. Si Computer Vision detecta mal, nadie lo verifica. Necesitamos cross-validation y confidence scoring."
        }
      ],
      "problemas_resueltos": [
        {
          "texto": "Un solo agente sobrecargado",
          "explicacion": "‚úÖ Resuelto en Layer 2"
        },
        {
          "texto": "No valida normativa",
          "explicacion": "‚úÖ Resuelto en Layer 2"
        },
        {
          "texto": "No actualiza gemelo digital",
          "explicacion": "‚úÖ Resuelto en Layer 2"
        },
        {
          "texto": "Agentes con acceso sin control",
          "explicacion": "Resuelto: Policy Engine + Whitelisting + Human-in-the-Loop controlan todas las acciones."
        }
      ]
    },
    {
      "id": 4,
      "nombre": "Monitorizaci√≥n, Calibraci√≥n y Gesti√≥n de Errores",
      "componentes": [
        {
          "tipo": "input",
          "label": "IM√ÅGENES",
          "descripcion": "Input"
        },
        {
          "tipo": "agent",
          "label": "SISTEMA MULTIAGENTE",
          "descripcion": "5 agentes coordinados"
        },
        {
          "tipo": "monitoring",
          "label": "DASHBOARD TIEMPO REAL",
          "descripcion": "M√©tricas en vivo",
          "ejemplo": "Latencia: 4.2s | Accuracy: 98.7% | Tokens: 125,430"
        },
        {
          "tipo": "monitoring",
          "label": "LOGGING INMUTABLE",
          "descripcion": "Logs encriptados y firmados",
          "ejemplo": "Cada operaci√≥n registrada con timestamp"
        },
        {
          "tipo": "monitoring",
          "label": "ERROR HANDLER",
          "descripcion": "Retry logic autom√°tico",
          "ejemplo": "Validador: 2 reintentos - API inestable"
        },
        {
          "tipo": "monitoring",
          "label": "ALERTING SYSTEM",
          "descripcion": "Notificaciones de anomal√≠as",
          "ejemplo": "‚ö†Ô∏è Gemelo Digital lento (5.3s > 5s threshold)"
        },
        {
          "tipo": "output",
          "label": "OUTPUT + M√âTRICAS",
          "descripcion": "Resultado con trazabilidad completa"
        }
      ],
      "puntos_fuertes": [
        {
          "texto": "Monitorizaci√≥n en tiempo real",
          "explicacion": "Dashboard muestra m√©tricas live: latencia por agente, throughput, errores, token usage. Detecta problemas antes de que afecten producci√≥n."
        },
        {
          "texto": "Logging inmutable para auditor√≠a",
          "explicacion": "Cada operaci√≥n genera log firmado criptogr√°ficamente. No se puede modificar ni borrar. Cumple requisitos de auditor√≠a y compliance."
        },
        {
          "texto": "Manejo autom√°tico de errores",
          "explicacion": "Si un agente falla (timeout, API error), el sistema reintenta autom√°ticamente con backoff exponencial. 3 intentos antes de escalar a humano."
        },
        {
          "texto": "Alertas por anomal√≠as",
          "explicacion": "Sistema detecta comportamientos an√≥malos: agente muy lento, accuracy bajando, errores aumentando. Alerta a equipo de ops autom√°ticamente."
        },
        {
          "texto": "M√©tricas de rendimiento por agente",
          "explicacion": "Desglose detallado: Computer Vision 2.1s avg, Validador 0.8s, Gemelo Digital 5.3s. Identifica cuellos de botella para optimizaci√≥n."
        },
        {
          "texto": "Dashboard de operaciones",
          "explicacion": "Panel centralizado para equipo de ops: estado de agentes, cola de procesamiento, historial de errores, m√©tricas de negocio (desviaciones detectadas/hora)."
        }
      ],
      "problemas": [
        {
          "texto": "¬øC√≥mo validamos que las decisiones son correctas?",
          "explicacion": "Tenemos m√©tricas de rendimiento pero no de calidad. Si Computer Vision dice 'desviaci√≥n 3cm', ¬øc√≥mo sabemos que es correcto? Falta validaci√≥n de evidencia."
        },
        {
          "texto": "¬øQu√© confianza tenemos en cada resultado?",
          "explicacion": "No hay confidence scoring. Una detecci√≥n con 60% de confianza se trata igual que una con 99%. Necesitamos cuantificar incertidumbre."
        }
      ],
      "problemas_resueltos": [
        {
          "texto": "Un solo agente sobrecargado",
          "explicacion": "‚úÖ Resuelto en Layer 2"
        },
        {
          "texto": "No valida normativa",
          "explicacion": "‚úÖ Resuelto en Layer 2"
        },
        {
          "texto": "No actualiza gemelo digital",
          "explicacion": "‚úÖ Resuelto en Layer 2"
        },
        {
          "texto": "Agentes con acceso sin control",
          "explicacion": "‚úÖ Resuelto en Layer 3"
        },
        {
          "texto": "Sin m√©tricas de rendimiento",
          "explicacion": "Resuelto: Dashboard en tiempo real + logging inmutable + alerting system."
        }
      ]
    },
    {
      "id": 5,
      "nombre": "Validadores y Grounding",
      "componentes": [
        {
          "tipo": "input",
          "label": "IM√ÅGENES",
          "descripcion": "Input"
        },
        {
          "tipo": "agent",
          "label": "SISTEMA MULTIAGENTE",
          "descripcion": "Agentes especializados"
        },
        {
          "tipo": "validation",
          "label": "GROUNDING ENGINE",
          "descripcion": "Verifica evidencia documental",
          "ejemplo": "100% afirmaciones con evidencia"
        },
        {
          "tipo": "validation",
          "label": "CROSS-VALIDATOR",
          "descripcion": "Validaci√≥n cruzada entre agentes",
          "ejemplo": "Confidence ajustado: 0.94 ‚Üí 0.91"
        },
        {
          "tipo": "validation",
          "label": "CONFIDENCE SCORING",
          "descripcion": "Puntuaci√≥n de confianza",
          "ejemplo": "Score > 0.85 ‚Üí Auto-approve"
        },
        {
          "tipo": "validation",
          "label": "CITATION SYSTEM",
          "descripcion": "Referencias trazables",
          "ejemplo": "Desviaci√≥n 3cm [1][2] excede tolerancia [2]"
        },
        {
          "tipo": "validation",
          "label": "HUMAN REVIEW",
          "descripcion": "Revisi√≥n humana si confidence < 0.85",
          "ejemplo": "Confidence 0.72 ‚Üí Requiere validaci√≥n"
        },
        {
          "tipo": "monitoring",
          "label": "MONITORING",
          "descripcion": "Dashboard completo"
        },
        {
          "tipo": "output",
          "label": "OUTPUT VALIDADO",
          "descripcion": "Resultado con evidencias y confianza"
        }
      ],
      "puntos_fuertes": [
        {
          "texto": "Grounding: toda afirmaci√≥n con evidencia documental",
          "explicacion": "Cada detecci√≥n est√° respaldada por evidencia: imagen analizada, medici√≥n DIGAV, estado previo TWINECO. No hay afirmaciones sin fundamento."
        },
        {
          "texto": "Cross-validation entre agentes",
          "explicacion": "Computer Vision detecta desviaci√≥n (confidence 0.94). Cross-Validator revisa evidencia, correlaciona con alertas previas, ajusta confidence a 0.91. Reduce falsos positivos."
        },
        {
          "texto": "Confidence scoring para decisiones",
          "explicacion": "Cada resultado tiene score 0-1. >0.85 ‚Üí auto-aprobado. 0.70-0.85 ‚Üí revisi√≥n opcional. <0.70 ‚Üí requiere humano. Decisiones basadas en certeza."
        },
        {
          "texto": "Citations completas y trazables",
          "explicacion": "Output incluye referencias: 'Desviaci√≥n 3cm [1][2] excede tolerancia 2cm [3]'. [1]=imagen, [2]=medici√≥n DIGAV, [3]=norma ADIF. Trazabilidad total."
        },
        {
          "texto": "Human-in-the-loop para baja confianza",
          "explicacion": "Si confidence < 0.85, ingeniero senior recibe notificaci√≥n con contexto completo. Puede aprobar, rechazar o solicitar m√°s informaci√≥n."
        },
        {
          "texto": "Sistema robusto y confiable",
          "explicacion": "Combinaci√≥n de especializaci√≥n, seguridad, monitorizaci√≥n y validaci√≥n. Sistema empresarial production-ready con SLA 99.9%."
        }
      ],
      "problemas": [],
      "problemas_resueltos": [
        {
          "texto": "Un solo agente sobrecargado",
          "explicacion": "‚úÖ Resuelto en Layer 2"
        },
        {
          "texto": "No valida normativa",
          "explicacion": "‚úÖ Resuelto en Layer 2"
        },
        {
          "texto": "No actualiza gemelo digital",
          "explicacion": "‚úÖ Resuelto en Layer 2"
        },
        {
          "texto": "Agentes con acceso sin control",
          "explicacion": "‚úÖ Resuelto en Layer 3"
        },
        {
          "texto": "Sin m√©tricas de rendimiento",
          "explicacion": "‚úÖ Resuelto en Layer 4"
        },
        {
          "texto": "Validaci√≥n de decisiones",
          "explicacion": "Resuelto: Grounding Engine + Cross-Validator verifican cada decisi√≥n con evidencia."
        },
        {
          "texto": "Nivel de confianza en resultados",
          "explicacion": "Resuelto: Confidence Scoring cuantifica certeza. Human review para casos de baja confianza."
        }
      ]
    }
  ]
}
